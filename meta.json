{
  "version": "3.0.0",

  "metadata": {
    "id": "extension-database",
    "name": "Database Support (JPA)",
    "kind": "extension",
    "type": "database",
    "layers": ["backend"],
    "description": "Adds JPA/database support with entity management, repositories, and connection pooling",
    "version": "1.0.0",
    "author": "Genesis Team",
    "tags": ["database", "jpa", "postgresql", "mysql", "spring"],
    "compatibleWith": ["spring"],
    "springProfiles": ["database"],
    "allowMultiple": true
  },

  "scaffoldConfigTemplate": [
    {
      "key": "databaseType",
      "label": "Database Type",
      "type": "select",
      "options": ["postgresql", "mysql", "mariadb", "h2"],
      "default": "postgresql",
      "required": true,
      "description": "Database management system",
      "category": "database"
    },
    {
      "key": "jpaVersion",
      "label": "JPA Version",
      "type": "select",
      "options": ["3.1.0", "3.2.0"],
      "default": "3.2.0",
      "required": true,
      "description": "JPA specification version",
      "category": "database"
    },
    {
      "key": "connectionPoolSize",
      "label": "Connection Pool Size",
      "type": "number",
      "default": 20,
      "required": true,
      "description": "Maximum database connection pool size",
      "category": "performance"
    },
    {
      "key": "ddlAuto",
      "label": "DDL Auto Mode",
      "type": "select",
      "options": ["none", "validate", "update", "create-drop"],
      "default": "validate",
      "required": true,
      "description": "Hibernate DDL auto mode",
      "category": "database"
    }
  ],

  "dependencies": {
    "gradle": [
      "implementation 'org.springframework.boot:spring-boot-starter-data-jpa'",
      "implementation 'org.liquibase:liquibase-core'",
      "compileOnly 'org.projectlombok:lombok'",
      "annotationProcessor 'org.projectlombok:lombok'"
    ],
    "maven": [
      "<dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-data-jpa</artifactId></dependency>",
      "<dependency><groupId>org.liquibase</groupId><artifactId>liquibase-core</artifactId></dependency>",
      "<dependency><groupId>org.projectlombok</groupId><artifactId>lombok</artifactId><optional>true</optional></dependency>"
    ]
  },

  "files": [
    "backend/src/main/java/{{packagePath}}/config/DatabaseConfig.java.mustache",
    "backend/src/main/java/{{packagePath}}/jpa/entity/BaseEntity.java.mustache",
    "backend/src/main/java/{{packagePath}}/jpa/entity/AppConfig.java.mustache",
    "backend/src/main/java/{{packagePath}}/jpa/repository/BaseRepository.java.mustache",
    "backend/src/main/java/{{packagePath}}/jpa/repository/AppConfigRepository.java.mustache",
    "backend/src/main/resources/application-database.yaml.mustache",
    "backend/src/main/resources/db/changelog/db.changelog-master.yaml.mustache",
    "backend/src/main/resources/db/changelog/changes/001-create-app-config-table.yaml.mustache",
    "backend/docker-compose.yml.mustache",
    "backend/start-local-db.sh.mustache"
  ],

  "generation": {
    "files": {
      "remove": []
    },
    "layers": {
      "backend": {
        "conditionalDependencies": {
          "databaseDriver": {
            "condition": "databaseType !== ''",
            "gradle": {
              "postgresql": ["runtimeOnly 'org.postgresql:postgresql'"],
              "mysql": ["runtimeOnly 'com.mysql:mysql-connector-j'"],
              "mariadb": ["runtimeOnly 'org.mariadb.jdbc:mariadb-java-client'"],
              "h2": ["runtimeOnly 'com.h2database:h2'"]
            }
          }
        }
      }
    },
    "postProcess": [
      {
        "type": "chmod",
        "pattern": "**/start-local-db.sh",
        "mode": "+x"
      }
    ]
  },

  "runtimeConfigTemplate": [
    {
      "key": "DB_HOST",
      "description": "Database host",
      "example": "localhost",
      "required": true,
      "secret": false,
      "targets": ["backend"]
    },
    {
      "key": "DB_PORT",
      "description": "Database port",
      "example": "5432",
      "required": true,
      "secret": false,
      "targets": ["backend"]
    },
    {
      "key": "DB_NAME",
      "description": "Database name",
      "example": "{{projectName}}",
      "required": true,
      "secret": false,
      "targets": ["backend"]
    },
    {
      "key": "DB_USERNAME",
      "description": "Database username",
      "example": "{{projectName}}_user",
      "required": true,
      "secret": false,
      "targets": ["backend"]
    },
    {
      "key": "DB_PASSWORD",
      "description": "Database password",
      "example": "changeme",
      "required": true,
      "secret": true,
      "targets": ["backend"]
    }
  ],

  "gitignore": [
    "# Database",
    "*.db",
    "*.sqlite",
    "",
    "# Docker volumes",
    ".docker/",
    ""
  ]
}
